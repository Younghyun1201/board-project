<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>게시판 프론트엔드</title>
</head>
<body>
  <h1>게시판 프론트엔드</h1>

  <h2>글 작성</h2>
  <form id="post-form">
    <input type="hidden" id="post-id" />
    <div>
      <label>제목: <input type="text" id="title" required /></label>
    </div>
    <div>
      <label>내용:</label><br />
      <textarea id="content" rows="4" cols="40" required></textarea>
    </div>
    <button type="submit">저장</button>
    <button type="button" id="cancel-edit" style="display:none;">수정 취소</button>
  </form>

  <h2>게시글 목록</h2>
  <table border="1" cellpadding="4">
    <thead>
      <tr>
        <th>ID</th><th>제목</th><th>내용</th><th>액션</th>
      </tr>
    </thead>
    <tbody id="posts-body"></tbody>
  </table>

  <script>
    // 여기 주소: 백엔드 NodePort (VM IP + 30081)
    const API_BASE = "http://192.168.64.12:30081";

    async function fetchPosts() {
      const res = await fetch(`${API_BASE}/posts`);
      const posts = await res.json();
      const tbody = document.getElementById("posts-body");
      tbody.innerHTML = "";
      posts.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.id}</td>
          <td>${p.title}</td>
          <td>${p.content}</td>
          <td>
            <button onclick="editPost(${p.id})">수정</button>
            <button onclick="deletePost(${p.id})">삭제</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function createPost(title, content) {
      await fetch(`${API_BASE}/posts`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ title, content })
      });
      await fetchPosts();
    }

    async function updatePost(id, title, content) {
      await fetch(`${API_BASE}/posts/${id}`, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ title, content })
      });
      await fetchPosts();
    }

    async function deletePost(id) {
      if (!confirm("정말 삭제할까요?")) return;
      await fetch(`${API_BASE}/posts/${id}`, {
        method: "DELETE",
      });
      await fetchPosts();
    }

    async function editPost(id) {
      const res = await fetch(`${API_BASE}/posts`);
      const posts = await res.json();
      const post = posts.find(p => p.id === id);
      if (!post) return;

      document.getElementById("post-id").value = post.id;
      document.getElementById("title").value = post.title;
      document.getElementById("content").value = post.content;
      document.getElementById("cancel-edit").style.display = "inline-block";
    }

    document.getElementById("cancel-edit").addEventListener("click", () => {
      document.getElementById("post-id").value = "";
      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
      document.getElementById("cancel-edit").style.display = "none";
    });

    document.getElementById("post-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("post-id").value;
      const title = document.getElementById("title").value;
      const content = document.getElementById("content").value;

      if (id) {
        await updatePost(id, title, content);
      } else {
        await createPost(title, content);
      }

      document.getElementById("post-id").value = "";
      document.getElementById("title").value = "";
      document.getElementById("content").value = "";
      document.getElementById("cancel-edit").style.display = "none";
    });

    // 페이지 로딩 시 최초 리스트 호출
    fetchPosts();
  </script>
</body>
</html>
